<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <title>MMT</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="dataTables.bootstrap.css">

    <link rel="stylesheet" href="jquery.treetable.css" />
    <link rel="stylesheet" href="jquery.treetable.theme.default.css" />
    <link rel="stylesheet" href="resource/css/batch.css" />

    <script type="text/javascript" language="javascript" src="jquery.js"></script>
    <script type="text/javascript" language="javascript" src="bootstrap.min.js"></script>
    <script type="text/javascript" language="javascript" src="jquery.dataTables.min.js"></script>
    <script type="text/javascript" language="javascript" src="dataTables.bootstrap.js"></script>
    <script type="text/javascript" language="javascript" src="treetable.js"></script>
    <script type="text/javascript" src="highcharts.js"></script>
    <script type="text/javascript" src="highcharts-more.js"></script>
    <script type="text/javascript" src="solid-gauge.src.js"></script>
    <script type="text/javascript" src="funnel.js"></script>
    <script type="text/javascript" src="mmt_drop.js"></script>

    <style>
        table.treetable {
            margin: 0;
        }
    </style>
</head>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">MMT Cloud</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="dash.html">Dashboard</a></li>
            <li><a href="hierarchy.html">Hierarchy</a></li>
            <li><a href="categories.html">Categories</a></li>
            <li><a href="apps.html">Applications</a></li>
            <li><a href="flow_cloud.html">Flow cloud</a></li>
            <li><a href="flow_avg.html">Flow avg</a></li>
            <li><a href="flow_density.html">Flow density</a></li>
          </ul>
        </div>
      </div>
    </div>
    
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-12 col-md-12 main">
            <div id="appreport" class="content"></div>
        </div>
      </div>
    </div>
    
    <script>
		var chartsElemMap = {};
                var gstats;
                var appReport;

Highcharts.setOptions({
                global: {
                    useUTC: false
                }
            });        		

        function initCharts(tstats, redraw) {
            gstats = new MMTDrop.GlobalStats();
            gstats.meta = tstats["metadata"];
            values = tstats.data;
            console.log(tstats.data);
            for (i in values) {
                if (values[i][MMTDrop.StatsColumnId.FORMAT_ID] == MMTDrop.CsvFormat.STATS_FORMAT) {
                    gstats.processEntry(values[i]);
                }
            }	

            appReport = MMTDrop.ReportFactory.createApplicationReport("appreport", gstats);

            chartsElemMap["appreport"] = [{"chart": appReport}];
            
            appReport.render();
      params = getUrlVars();
      p = params.period || '1h';

      if(p === '1h') $('#appreport_ftr_period').val('1 Hour');
      else if(p === '24h') $('#appreport_ftr_period').val('1 Day');
      else if(p === 'week') $('#appreport_ftr_period').val('1 Week');
      else if(p === 'month') $('#appreport_ftr_period').val('1 Month');
        }

    function firstdraw(period, elem) {
      if(period === '1 Hour') period = '1h';
      else if(period === '1 Day') period = '24h';
      else if(period === '1 Week') period = 'week';
      else if(period === '1 Month') period = 'month';
      $.ajax({
          url:"/traffic/data?period=" + period,  
          success:function(data) {
              initCharts(data);
          }
      });
      
    }

    function redraw(period, elem) {
      p = '1h';
      if(period === '1 Hour') p = '1h';
      else if(period === '1 Day') p = '24h';
      else if(period === '1 Week') p = 'week';
      else if(period === '1 Month') p = 'month';
      window.location.href = '/apps.html?period=' + p;
    }

    // Read a page's GET URL variables and return them as an associative array.
function getUrlVars()
{
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}

    $(document).ready(function() {
      params = getUrlVars();
      p = params.period || '1h';
      firstdraw(p);
    });
         
	</script>

</body>
</html>
